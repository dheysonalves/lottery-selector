import { createSlice } from "@reduxjs/toolkit";
import {
	IContestResponseTypes,
	IErrorResponseTypes,
	ILotteryContestResponseTypes,
	ILotteryResponseTypes,
} from "../../../@types/lotery";
import { RootState } from "../../../app/store";
import { fetchContestsThunk, fetchLotteryContestsThunk, fetchLotteryThunk } from "./lotteryThunk";

export interface LotteryState {
	lotteryData: ILotteryResponseTypes[] | IErrorResponseTypes;
	lotteryContestData: ILotteryContestResponseTypes[] | IErrorResponseTypes;
	contestData: IContestResponseTypes | IErrorResponseTypes | null;
	status: "idle" | "loading" | "failed";
}

const initialState: LotteryState = {
	lotteryData: [],
	lotteryContestData: [],
	contestData: null,
	status: "idle",
};

export const lotterySlice = createSlice({
	name: "lottery",
	initialState,
	// The `reducers` field lets us define reducers and generate associated actions
	reducers: {},
	// The `extraReducers` field lets the slice handle actions defined elsewhere,
	// including actions generated by createAsyncThunk or in other slices.
	extraReducers: (builder) => {
		builder
			.addCase(fetchLotteryThunk.pending, (state) => {
				state.status = "loading";
				state.lotteryData = [];
			})
			.addCase(fetchLotteryThunk.fulfilled, (state, action) => {
				state.status = "idle";
				state.lotteryData = action.payload;
			});
		builder
			.addCase(fetchLotteryContestsThunk.pending, (state) => {
				state.status = "loading";
				state.lotteryContestData = [];
			})
			.addCase(fetchLotteryContestsThunk.fulfilled, (state, action) => {
				state.status = "idle";
				state.lotteryContestData = action.payload;
			});
		builder
			.addCase(fetchContestsThunk.pending, (state) => {
				state.status = "loading";
				state.contestData = null;
			})
			.addCase(fetchContestsThunk.fulfilled, (state, action) => {
				state.status = "idle";
				state.contestData = action.payload;
			});
	},
});

export const selectCount = (state: RootState) => state.lottery;

export default lotterySlice.reducer;

